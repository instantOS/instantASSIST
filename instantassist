#!/usr/bin/env dash

# main menu to access instantASSIST

ASSIST=$( (cat /usr/share/instantassist/cache/cache; echo /search assists) | instantmenu -i -p instantASSIST -F -ct | grep -o '^.')

[ -z "$ASSIST" ] && exit

if [ "$ASSIST" = '/' ]; then
    SCRIPTPATH="/usr/share/instantassist/assists/\
$(cat /usr/share/instantassist/cache/search |
instantmenu -p 'assist:' -l 8 -i -g 3 -q 'search assists' -h -1 -r |
sed 's/^.*(//;s/)$//;s/.$/\/&/;s/^\///')"
    echo $SCRIPTPATH
    [ -e "$SCRIPTPATH" ] && exit
else

if [ -d /usr/share/instantassist/assists/"$ASSIST" ]; then
    ASSIST2="$(instantmenu -i -p instantASSIST -n -h 32 -F -ct </usr/share/instantassist/cache/"$ASSIST"/cache | grep -o '^.')"
    [ -z "$ASSIST2" ] && exit
    SCRIPTPATH=/usr/share/instantassist/assists/"$ASSIST/$ASSIST2"
else
    if ! [ -e /usr/share/instantassist/assists/"$PAPERAPP" ]; then
        echo "assist not found"
        exit
    fi
    SCRIPTPATH=/usr/share/instantassist/assists/"$ASSIST"
fi
fi

"${SCRIPTPATH}.sh" &
iconf lastassist "${SCRIPTPATH}.sh"
